# –ó–∞–¥–∞—á–∞ 3: –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞

## –¶–µ–ª—å

–ó–∞–∫—Ä–µ–ø–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å PostgreSQL –∏ –Ω–∞—É—á–∏—Ç—å—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** –≤ Go –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–ª–æ–∂–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π.

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ —Ç—ã:

- —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä—É–µ—à—å –ø—Ä–æ—Å—Ç–æ–π `OrderRepository` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–∫–∞–∑–∞–º–∏;
- —Ä–µ–∞–ª–∏–∑—É–µ—à—å –º–µ—Ç–æ–¥ `CreateOrder`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞—ë—Ç –∑–∞–∫–∞–∑ **–≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**:
  - –≤—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü—É `orders`;
  - –≤—Å—Ç–∞–≤–ª—è–µ—Ç –æ–¥–Ω—É –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π –≤ —Ç–∞–±–ª–∏—Ü—É `order_items`;
- –ø–æ–π–º—ë—à—å, –∑–∞—á–µ–º –Ω—É–∂–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∏ —á—Ç–æ –±—É–¥–µ—Ç, –µ—Å–ª–∏ –µ—ë –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.

---

## –û–±—â–∞—è –∏–¥–µ—è

–£ –Ω–∞—Å –µ—Å—Ç—å —É–ø—Ä–æ—â—ë–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞:

- `orders` ‚Äî —Ç–∞–±–ª–∏—Ü–∞ –∑–∞–∫–∞–∑–æ–≤;
- `order_items` ‚Äî —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–∑–∏—Ü–∏–π –∑–∞–∫–∞–∑–∞ (–∫–∞–∫–æ–π —Ç–æ–≤–∞—Ä –∏ –≤ –∫–∞–∫–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –±—ã–ª –∑–∞–∫–∞–∑–∞–Ω).

–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –≤–∫–ª—é—á–∞–µ—Ç –¥–≤–∞ —à–∞–≥–∞:

1. –°–æ–∑–¥–∞—Ç—å —Å–∞–º –∑–∞–∫–∞–∑ (—Å—Ç—Ä–æ–∫—É –≤ `orders`).
2. –î–æ–±–∞–≤–∏—Ç—å –∫ –Ω–µ–º—É –ø–æ–∑–∏—Ü–∏–∏ (—Å—Ç—Ä–æ–∫–∏ –≤ `order_items`).

–û–±–µ —á–∞—Å—Ç–∏ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–π—Ç–∏ **—É—Å–ø–µ—à–Ω–æ**. –ï—Å–ª–∏ –≤—Å—Ç–∞–≤–∏–ª–∏ –∑–∞–∫–∞–∑, –Ω–æ –Ω–µ —Å–º–æ–≥–ª–∏ –≤—Å—Ç–∞–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏–∏ ‚Äî –∑–∞–∫–∞–∑ –ø–æ–ª—É—á–∏—Ç—Å—è ¬´–±–∏—Ç—ã–º¬ª. –ü–æ—ç—Ç–æ–º—É –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é**: –ª–∏–±–æ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ `CreateOrder` –∑–∞–≤–µ—Ä—à–∞—Ç—Å—è —É—Å–ø–µ—à–Ω–æ, –ª–∏–±–æ –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–∫–∞—Ç—è—Ç—Å—è.

---

## –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º–∞—è —Å—Ö–µ–º–∞ —Ç–∞–±–ª–∏—Ü

### –¢–∞–±–ª–∏—Ü–∞ `orders`

```sql
CREATE TABLE orders (
    id           SERIAL PRIMARY KEY,
    user_id      INT NOT NULL,
    total_amount NUMERIC(10, 2) NOT NULL,
    created_at   TIMESTAMP NOT NULL DEFAULT NOW()
);
```

### –¢–∞–±–ª–∏—Ü–∞ `order_items`

```sql
CREATE TABLE order_items (
    id         SERIAL PRIMARY KEY,
    order_id   INT NOT NULL,
    product_id INT NOT NULL,
    quantity   INT NOT NULL,
    price      NUMERIC(10, 2) NOT NULL
);
```

> üí° –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ `user_id`, `product_id` –∏ `order_id` –±—É–¥—É—Ç –≤–Ω–µ—à–Ω–∏–º–∏ –∫–ª—é—á–∞–º–∏ (`REFERENCES`), –Ω–æ –¥–ª—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏ –º–æ–∂–Ω–æ —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö –∏ –±–∞–∑–æ–≤–æ–π –ª–æ–≥–∏–∫–µ –≤—Å—Ç–∞–≤–∫–∏.

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–ø—Ä–∏–º–µ—Ä)

```text
lesson7/
  practice/
    task_3/
      go.mod
      cmd/
        api/
          main.go                   // —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏)
      internal/
        entities/
          order.go                  // —Å—É—â–Ω–æ—Å—Ç–∏ Order –∏ OrderItem / OrderItemInput
        repository/
          order_repo.go             // –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è OrderRepository
        service/
          order_service.go          // –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

–¢–æ—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–∂–µ—Ç –Ω–µ–º–Ω–æ–≥–æ –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç —à–∞–±–ª–æ–Ω–∞, –∫–æ—Ç–æ—Ä—ã–π —É —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å, –Ω–æ –≤–∞–∂–Ω–æ, —á—Ç–æ–±—ã:

- –±—ã–ª **—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–∫–∞–∑–∞–º–∏;
- –≤–Ω—É—Ç—Ä–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å **—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è** (`db.Begin`, `tx.Commit`, `tx.Rollback`).

---

## –ß–∞—Å—Ç—å 1. –°—É—â–Ω–æ—Å—Ç–∏ –¥–ª—è –∑–∞–∫–∞–∑–∞

**–§–∞–π–ª (–ø—Ä–∏–º–µ—Ä):** `internal/entities/order.go`

–û–ø–∏—à–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥—É—Ç —Ç–µ–±–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∑–∞–∫–∞–∑–∞–º–∏ –≤ –∫–æ–¥–µ.

–ü—Ä–∏–º–µ—Ä (–º–æ–∂–Ω–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ —Å–≤–æ–π —à–∞–±–ª–æ–Ω):

```go
package entities

type Order struct {
    ID          int
    UserID      int
    TotalAmount float64
}

type OrderItem struct {
    ID        int
    OrderID   int
    ProductID int
    Quantity  int
    Price     float64
}
```

–î–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –º–æ–∂–Ω–æ –≤–≤–µ—Å—Ç–∏ –æ—Ç–¥–µ–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–±–µ–∑ ID):

```go
// –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫–∞–∑–∞
type OrderItemInput struct {
    ProductID int
    Quantity  int
    Price     float64
}
```

–û–±—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—Ö–æ–¥–∞ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–∞–∫–æ–π:

```go
type CreateOrderInput struct {
    UserID int
    Items  []OrderItemInput
}
```

–¢—ã –º–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∞–∫—É—é —Ñ–æ—Ä–º—É –∏–ª–∏ —Å–≤–æ—é ‚Äî –≥–ª–∞–≤–Ω–æ–µ, —á—Ç–æ–±—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–º–æ–≥:

- —É–∑–Ω–∞—Ç—å, –¥–ª—è –∫–∞–∫–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–∫–∞–∑;
- –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–∑–∏—Ü–∏–π –∑–∞–∫–∞–∑–∞ —Å `product_id`, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∏ —Ü–µ–Ω–æ–π.

---

## –ß–∞—Å—Ç—å 2. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å `OrderRepository`

**–§–∞–π–ª (–ø—Ä–∏–º–µ—Ä):** `internal/repository/order_repo.go`

–û–ø–∏—à–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –¥–ª—è –∑–∞–∫–∞–∑–æ–≤:

```go
package repository

import "bitlab_golang_module_3/lesson7/practice/task_3/internal/entities"

type OrderRepository interface {
    CreateOrder(input entities.CreateOrderInput) (int, error)
}
```

> üí° –ú–µ—Ç–æ–¥ –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `id` —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞. –ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî –º–æ–∂–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∏ —Å–∞–º—É —Å—É—â–Ω–æ—Å—Ç—å `Order`.

–ï—Å–ª–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É —Ç–µ–±—è —É–∂–µ –æ–ø–∏—Å–∞–Ω –≤ –¥—Ä—É–≥–æ–º —Å–ª–æ–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ `service`), –∏—Å–ø–æ–ª—å–∑—É–π –µ–≥–æ.

---

## –ß–∞—Å—Ç—å 3. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è `OrderRepository` —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π

**–§–∞–π–ª:** `internal/repository/order_repo_pg.go`

### 3.1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

–°–æ–∑–¥–∞–π —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –∫–æ—Ç–æ—Ä–∞—è —Ö—Ä–∞–Ω–∏—Ç `*sql.DB`:

```go
package repository

import (
    "database/sql"

    "bitlab_golang_module_3/lesson7/practice/task_3/internal/entities"
)

type PostgresOrderRepository struct {
    db *sql.DB
}

func NewPostgresOrderRepository(db *sql.DB) *PostgresOrderRepository {
    return &PostgresOrderRepository{db: db}
}
```

### 3.2. –ú–µ—Ç–æ–¥ `CreateOrder` —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π

–†–µ–∞–ª–∏–∑—É–π –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π:

1. –ù–∞—á–∏–Ω–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é: `tx, err := r.db.Begin()`.
2. –í—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –≤ `orders` –∏ –ø–æ–ª—É—á–∞–µ—Ç `order_id` —á–µ—Ä–µ–∑ `RETURNING id`.
3. –í —Ü–∏–∫–ª–µ –≤—Å—Ç–∞–≤–ª—è–µ—Ç –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏ –≤ `order_items`, –∏—Å–ø–æ–ª—å–∑—É—è `order_id`.
4. –ï—Å–ª–∏ –≤—Å—ë —É—Å–ø–µ—à–Ω–æ ‚Äî –¥–µ–ª–∞–µ—Ç `tx.Commit()`.
5. –ï—Å–ª–∏ –Ω–∞ –ª—é–±–æ–º —à–∞–≥–µ –æ—à–∏–±–∫–∞ ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç `tx.Rollback()` –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É.

–ó–∞–≥–æ—Ç–æ–≤–∫–∞:

```go
func (r *PostgresOrderRepository) CreateOrder(input entities.CreateOrderInput) (int, error) {
    tx, err := r.db.Begin()
    if err != nil {
        return 0, err
    }

    // –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –æ—à–∏–±–∫–∞ ‚Äî –æ—Ç–∫–∞—Ç—ã–≤–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
    defer func() {
        if err != nil {
            tx.Rollback()
        }
    }()

    // 1. –í—Å—Ç–∞–≤–∫–∞ –≤ orders
    var orderID int
    const insertOrderQuery = `
        INSERT INTO orders (user_id, total_amount)
        VALUES ($1, $2)
        RETURNING id;
    `

    total := calculateTotal(input.Items) // TODO: —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –ø–æ–¥—Å—á—ë—Ç–∞ —Å—É–º–º—ã

    err = tx.QueryRow(insertOrderQuery, input.UserID, total).Scan(&orderID)
    if err != nil {
        return 0, err
    }

    // 2. –í—Å—Ç–∞–≤–∫–∞ –ø–æ–∑–∏—Ü–∏–π –≤ order_items
    const insertItemQuery = `
        INSERT INTO order_items (order_id, product_id, quantity, price)
        VALUES ($1, $2, $3, $4);
    `

    for _, item := range input.Items {
        _, err = tx.Exec(insertItemQuery, orderID, item.ProductID, item.Quantity, item.Price)
        if err != nil {
            return 0, err
        }
    }

    // 3. –§–∏–∫—Å–∏—Ä—É–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
    if err = tx.Commit(); err != nil {
        return 0, err
    }

    return orderID, nil
}
```

> ‚ö†Ô∏è –û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ: –∑–¥–µ—Å—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–º–µ–Ω–æ–≤–∞–Ω–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `err`, —á—Ç–æ–±—ã `defer` –∑–Ω–∞–ª, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –ª–∏ –æ—à–∏–±–∫–∞. –≠—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω —Ä–∞–±–æ—Ç—ã —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ –≤ Go.

–§—É–Ω–∫—Ü–∏—é `calculateTotal` –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ:

```go
func calculateTotal(items []entities.OrderItemInput) float64 {
    var total float64
    for _, item := range items {
        total += item.Price * float64(item.Quantity)
    }
    return total
}
```

–ú–æ–∂–µ—à—å –ø–æ–ª–æ–∂–∏—Ç—å –µ—ë –ª–∏–±–æ –≤ —Ç–æ—Ç –∂–µ —Ñ–∞–π–ª, –ª–∏–±–æ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π utils-—Ñ–∞–π–ª.

---

## –ß–∞—Å—Ç—å 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å)

–ï—Å–ª–∏ —É —Ç–µ–±—è –≤ –ø—Ä–æ–µ–∫—Ç–µ –µ—Å—Ç—å —Å–ª–æ–π `service`, –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫:

**–§–∞–π–ª:** `internal/service/order_service.go`

```go
package service

import "bitlab_golang_module_3/lesson7/practice/task_3/internal/entities"

type OrderRepository interface {
    CreateOrder(input entities.CreateOrderInput) (int, error)
}

type OrderService struct {
    repo OrderRepository
}

func NewOrderService(r OrderRepository) *OrderService {
    return &OrderService{repo: r}
}

func (s *OrderService) CreateOrder(input entities.CreateOrderInput) (int, error) {
    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é, –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ —Ç.–¥.
    return s.repo.CreateOrder(input)
}
```

–î–∞–ª—å—à–µ —Å–µ—Ä–≤–∏—Å –º–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –∏–∑ —Ö–µ–Ω–¥–ª–µ—Ä–∞ HTTP (–µ—Å–ª–∏ —Ç—ã —É–∂–µ –Ω–∞ —ç—Ç–æ–º —É—Ä–æ–≤–Ω–µ –º–æ–¥—É–ª—è).

---

## –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ—à–µ–Ω–∏–µ

1. –£–±–µ–¥–∏—Å—å, —á—Ç–æ —É —Ç–µ–±—è –µ—Å—Ç—å —Ç–∞–±–ª–∏—Ü—ã `orders` –∏ `order_items` –≤ PostgreSQL.

2. –ù–∞–ø–∏—à–∏ –ø—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ (–≤ `cmd/api/main.go` –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ), –∫–æ—Ç–æ—Ä—ã–π:

   - —Å–æ–∑–¥–∞—ë—Ç `*sql.DB` –∏ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –ë–î;
   - —Å–æ–∑–¥–∞—ë—Ç `PostgresOrderRepository`;
   - –≤—ã–∑—ã–≤–∞–µ—Ç `CreateOrder` —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä:

     ```go
     input := entities.CreateOrderInput{
         UserID: 1,
         Items: []entities.OrderItemInput{
             {ProductID: 1, Quantity: 2, Price: 10.0},
             {ProductID: 2, Quantity: 1, Price: 5.5},
         },
     }
     ```

3. –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ—Å–º–æ—Ç—Ä–∏ –≤ –ë–î (—á–µ—Ä–µ–∑ `psql` –∏–ª–∏ GUI-–∫–ª–∏–µ–Ω—Ç):

   ```sql
   SELECT * FROM orders;
   SELECT * FROM order_items;
   ```

   –£–±–µ–¥–∏—Å—å, —á—Ç–æ:

   - –ø–æ—è–≤–∏–ª—Å—è –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑ –≤ `orders` —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π `total_amount`;
   - –≤ `order_items` –µ—Å—Ç—å —Å—Ç—Ä–æ–∫–∏ —Å `order_id`, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –∑–∞–∫–∞–∑—É.

4. –ü–æ–ø—Ä–æ–±—É–π –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ —Å–ª–æ–º–∞—Ç—å –≤—Å—Ç–∞–≤–∫—É –≤ `order_items` (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–¥–µ–ª–∞—Ç—å `product_id` –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º, –µ—Å–ª–∏ —Å—Ç–æ—è—Ç –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏) –∏ —É–±–µ–¥–∏—Å—å, —á—Ç–æ:

   - –∑–∞–∫–∞–∑ **–Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è**;
   - –≤ —Ç–∞–±–ª–∏—Ü–µ `orders` –Ω–µ—Ç ¬´–ø—É—Å—Ç—ã—Ö¬ª –∑–∞–∫–∞–∑–æ–≤ –±–µ–∑ –ø–æ–∑–∏—Ü–∏–π.

–ï—Å–ª–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏ –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ –≤–Ω—É—Ç—Ä–∏ –º–µ—Ç–æ–¥–∞ `CreateOrder` –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–∞—Ç—ã–≤–∞—é—Ç—Å—è ‚Äî —Ç—ã —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ üí™
